<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NHL Prediction Scenarios | M. Nasiri</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f8f9fa; color: #333; font-family: 'Segoe UI', system-ui, sans-serif; line-height: 1.7; }
        
        /* Sidebar Styling */
        .sidebar {
            position: sticky;
            top: 2rem;
            height: calc(100vh - 4rem);
            overflow-y: auto;
            border-right: 1px solid #dee2e6;
            padding-right: 20px;
        }
        .nav-link { color: #555; font-size: 0.9rem; padding: 8px 0; transition: all 0.2s; }
        .nav-link:hover { color: #0d6efd; transform: translateX(5px); }
        .nav-link.active { color: #0d6efd; font-weight: 700; border-right: 3px solid #0d6efd; }
        .nav-group-title { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: #adb5bd; margin-top: 25px; margin-bottom: 10px; font-weight: bold; }

        /* Main Content Styling */
        .main-content { padding-left: 50px; padding-bottom: 100px; }
        h1, h2, h3 { color: #2c3e50; }
        h2 { margin-top: 40px; border-bottom: 2px solid #e9ecef; padding-bottom: 10px; font-weight: 700; }
        
        /* Scenario Boxes (What If) */
        .hypothesis-box {
            background-color: #fff;
            border-left: 5px solid #6c757d;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 25px;
            margin: 30px 0;
            border-radius: 0 8px 8px 0;
            transition: transform 0.2s;
        }
        .hypothesis-box:hover { transform: translateX(5px); }
        
        /* Scenario Colors */
        .scenario-a { border-color: #fd7e14; } /* Orange for Baseline */
        .scenario-a .hypothesis-title { color: #fd7e14; }
        
        .scenario-b { border-color: #198754; } /* Green for XGBoost */
        .scenario-b .hypothesis-title { color: #198754; }

        .hypothesis-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 10px; display: flex; align-items: center; }
        .hypothesis-text { font-style: italic; font-size: 1.05rem; color: #495057; margin-bottom: 0; }

        /* Code Blocks */
        pre { background: #282c34; color: #abb2bf; padding: 20px; border-radius: 8px; font-size: 0.9em; border: 1px solid #3e4451; }
        code { font-family: 'Consolas', 'Monaco', monospace; }
        .comment { color: #5c6370; font-style: italic; }
        .keyword { color: #c678dd; }
        .string { color: #98c379; }
        .function { color: #61afef; }

        .scenario-divider { border-top: 1px dashed #ccc; margin: 60px 0; position: relative; }
        .scenario-divider::after { content: "Next Experiment"; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: #f8f9fa; padding: 0 10px; color: #aaa; font-size: 0.8rem; }
    </style>
</head>
<body>

    <nav class="navbar navbar-light bg-white border-bottom mb-5 fixed-top">
        <div class="container-fluid px-5">
            <a class="navbar-brand text-primary fw-bold" href="../../index.html">
                <i class="fas fa-chevron-left me-2"></i> Mohammad G. Nasiri
            </a>
            <span class="badge bg-dark">Project: NHL Hockey Challenge</span>
        </div>
    </nav>
    <div style="margin-top: 80px;"></div> <div class="container-fluid px-5">
        <div class="row">
            
            <div class="col-md-3 d-none d-md-block">
                <nav id="toc" class="sidebar flex-column">
                    <div class="nav-group-title">Introduction</div>
                    <a class="nav-link" href="#problem-definition">The Problem</a>
                    <a class="nav-link" href="#data-prep">Data Preparation</a>
                    
                    <div class="nav-group-title">Experiment A</div>
                    <a class="nav-link" href="#scenario-a-hypothesis">Hypothesis: The Hot Hand</a>
                    <a class="nav-link" href="#scenario-a-implementation">Implementation (Logistic)</a>
                    <a class="nav-link" href="#scenario-a-failure">Why it Failed?</a>

                    <div class="nav-group-title">Experiment B</div>
                    <a class="nav-link" href="#scenario-b-hypothesis">Hypothesis: Rare Events</a>
                    <a class="nav-link" href="#scenario-b-model">Solution: XGBoost</a>
                    <a class="nav-link" href="#scenario-b-results">Final Results</a>
                </nav>
            </div>

            <div class="col-md-9 main-content" data-bs-spy="scroll" data-bs-target="#toc" data-bs-offset="0" tabindex="0">
                
                <section id="problem-definition">
                    <h1 class="display-4 fw-bold mb-3">Predicting NHL Goal Scorers</h1>
                    <p class="lead text-muted">A Comparative Analysis of Machine Learning Strategies for the Tim Hortons Challenge.</p>
                    <p>
                        The goal is simple: Pick 3 players who will score a goal today. <br>
                        The challenge is mathematical: In any given game, a specific player has only an <strong>8-12% probability</strong> of scoring. This makes it a classic "Imbalanced Classification" problem.
                    </p>
                </section>

                <section id="data-prep">
                    <h3>Data Preparation Pipeline</h3>
                    <p>I utilized the NHL Public API to scrape 3 years of play-by-play data. The raw data was transformed into a transactional dataset where each row represents a <code>(Player, Game)</code> tuple.</p>
                    <ul>
                        <li><strong>Target Variable:</strong> <code>is_scorer</code> (0 or 1).</li>
                        <li><strong>Data Volume:</strong> ~50,000 rows (Player-Games).</li>
                    </ul>
                </section>

                <div class="scenario-divider"></div>

                <section id="scenario-a-hypothesis">
                    <div class="badge bg-warning text-dark mb-2">Experiment A</div>
                    <h2 class="fw-bold">The Baseline Approach</h2>
                    
                    <div class="hypothesis-box scenario-a">
                        <div class="hypothesis-title"><i class="fas fa-question-circle me-2"></i> The "What If" Hypothesis</div>
                        <p class="hypothesis-text">
                            "What if scoring is simply a function of recent form? If we use a simple linear model (Logistic Regression) on players' recent stats, we should be able to identify who is 'due' for a goal."
                        </p>
                    </div>
                </section>

                <section id="scenario-a-implementation">
                    <h3>Implementation: Logistic Regression</h3>
                    <p>I engineered simple "lag features" representing the player's performance in the last 5 games.</p>
                    
                    <pre><code><span class="comment"># Feature Engineering: Rolling Average of Goals</span>
df['last_5_goals'] = df.groupby('player_id')['goals'].transform(lambda x: x.rolling(5).mean())

<span class="comment"># Simple Logistic Model</span>
from sklearn.linear_model import LogisticRegression
model = LogisticRegression()
model.fit(X_train, y_train)</code></pre>
                </section>

                <section id="scenario-a-failure">
                    <h3>The Result: The Accuracy Paradox</h3>
                    <p>The model achieved <strong>91% Accuracy</strong>. Sounds great, right?</p>
                    <p class="text-danger fw-bold">Wrong.</p>
                    <p>
                        Since only 9% of players score, the model simply learned to predict <strong>0 (No Goal)</strong> for everyone. It optimized for accuracy by never taking a risk.
                        <br>
                        <strong>Recall Score:</strong> 0.02 (It missed 98% of actual goals).
                    </p>
                </section>

                <div class="scenario-divider"></div>

                <section id="scenario-b-hypothesis">
                    <div class="badge bg-success mb-2">Experiment B</div>
                    <h2 class="fw-bold">The Advanced Approach (GBDT)</h2>
                    
                    <div class="hypothesis-box scenario-b">
                        <div class="hypothesis-title"><i class="fas fa-lightbulb me-2"></i> The Pivot</div>
                        <p class="hypothesis-text">
                            "What if we treat this explicitly as an <strong>Imbalanced Learning</strong> problem? Instead of just player form, let's look at the <strong>context</strong> (Opponent Defense, Fatigue) and force the model to care about the minority class."
                        </p>
                    </div>
                </section>

                <section id="scenario-b-model">
                    <h3>Solution: XGBoost & Contextual Features</h3>
                    <p>I switched to <strong>XGBoost</strong> (Gradient Boosted Decision Trees) for its ability to handle non-linear relationships. Crucially, I introduced two changes:</p>
                    
                    <ol>
                        <li><strong>New Features:</strong> Added `Opponent_GAA` (Goals Against Average) and `Is_Back_to_Back` (Fatigue).</li>
                        <li><strong>Scale Pos Weight:</strong> This parameter tells XGBoost to penalize missing a goal 10x more than falsely predicting one.</li>
                    </ol>

                    <pre><code><span class="comment"># Handling Imbalance with scale_pos_weight</span>
<span class="keyword">from</span> xgboost <span class="keyword">import</span> XGBClassifier

ratio = float(np.sum(y == 0)) / np.sum(y == 1) <span class="comment"># approx 10.0</span>

model = XGBClassifier(
    scale_pos_weight=ratio,
    learning_rate=0.01,
    max_depth=4,
    n_estimators=500
)</code></pre>
                </section>

                <section id="scenario-b-results">
                    <h3>Final Results & Comparison</h3>
                    <p>By prioritizing Recall over Accuracy, the model started identifying risky but potential scorers.</p>

                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card bg-light border-0">
                                <div class="card-body text-center">
                                    <h5 class="card-title text-muted">Baseline AUC</h5>
                                    <h2 class="text-secondary">0.61</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-white border-success shadow-sm">
                                <div class="card-body text-center">
                                    <h5 class="card-title text-success">XGBoost AUC</h5>
                                    <h2 class="display-4 fw-bold text-success">0.76</h2>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h5>Key Takeaway:</h5>
                        <p>The "Hot Hand" (Scenario A) is less predictive than "Opponent Weakness" (Scenario B). The XGBoost model successfully identified that playing against a weak defense is the strongest predictor of scoring.</p>
                    </div>
                    
                    <div class="text-center mt-5 p-5 border border-dashed rounded text-muted">
                        <i class="fas fa-chart-bar fa-3x mb-3"></i><br>
                        [Place your Feature Importance Plot here in future]
                    </div>

                </section>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
